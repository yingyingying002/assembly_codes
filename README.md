# 《汇编语言》第三版(王爽著)的各实验代码

### 课程设计2：
课程设计要求的功能较为复杂，单个扇区(512B)保存完整代码可能不够用，采用多扇区启动：
通过启动引导代码(扇区1)，执行其他扇区(扇区2、3)保存的课程设计代码。
注意：BIOS启动后不会执行.exe文件，需要将涉及的代码转为.bin文件之后，再将.bin文件直接写入软盘。这样才可以作为系统代码。而.bin文件中，不允许声明栈段(独立的数据段也会影响代码长度计算)。为了方便，系统代码中，一般只使用代码段。

环境准备：
以windos系统为例
```
DosBox  
masm编译工具链
UltraIso    生成软盘镜像.ima
Winhex      可以直接查看ima文件的二进制内容，方便检查
virtualBox、vmWare等虚拟机管理软件
```

#### 一、编写启动引导代码boot.asm，实现系统启动后读取多扇区部署的完整课程设计代码
系统启动后，会将第一扇区的代码读入内存7c00:0000并自动执行。所以将自行编写的启动引导代码写入软盘第一扇区即可。

由于代码要写入扇区，需要填充扇区剩余空间为0

```boot.asm
1. 声明org 7c00h，表示该代码将被加载到内存7c00:0000执行。
2. 读取其他扇区(扇区2、3)的代码，并加载到内存7e00:0000，然后开始执行7e00:0000的代码
3. 填充扇区剩余空间为0，并添加结束标志
    db 510-($ - offset start) dup(0) ; 填充剩余空间
    dw 0aa55h           ; 引导扇区结束标志
```

#### 二、编写课程设计要求的系统代码，即主程序逻辑
```design2.asm
1. 在代码段声明数据段、栈段的空间
2. 实现主程序逻辑
3. 填充扇区剩余空间为0，并添加结束标志
    db 1022-($ - offset start) dup(0) ; 填充剩余空间
    dw 0aa55h           ; 引导扇区结束标志
```

#### 三、环境准备：生成.bin文件
```
masm boot.asm
link boot.obj
exe2bin boot.exe boot.bin

masm design2.asm
link design2.obj
exe2bin design2.exe design2.bin
```

#### 四、编写软盘写入代码load_design2.asm，将.bin文件写入软盘
注意：扇区1也有文件系统逻辑，覆盖写入之后可能导致DosBox无法再通过该软盘镜像挂载，因为覆盖之后文件系统无法识别。
```
1. boot.bin文件写入扇区1
2. design2.bin文件写入扇区2~3
```

#### 五、配置虚拟机从软盘启动
virtualBox、vmware等软件，都可以创建虚拟机并从软盘启动

```
配置virtualBox虚拟机从软盘启动
https://soft.zol.com.cn/1046/10462984.html
```